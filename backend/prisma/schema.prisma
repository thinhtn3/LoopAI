datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}
generator client {
  provider = "prisma-client-js"
}

model Session {
  id        String   @id @default(uuid())
  title     String?
  model     String
  createdAt DateTime @default(now())
  userId    String
  messages  Message[]
  problemSlug String
  problem     Problem? @relation(fields: [problemSlug], references: [slug], onDelete: SetNull, onUpdate: Cascade)
  @@unique([userId, problemSlug])
}


model Message {
  id        String   @id @default(uuid())
  sessionId String
  session   Session  @relation(fields: [sessionId], references: [id])
  role      String
  content   Json
  createdAt DateTime @default(now())
}

/*** New models for Leetcode***/
model Problem {
  slug        String   @id              // leetcode titleSlug
  title       String
  url         String
  difficulty  Difficulty
  frontendId  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tags        Tag[]                     // Many-to-many relationship
  sessions    Session[]
  @@index([title]) // basic btree index (use pg_trgm below for fuzzy/substring)
}

model Tag {
  id        Int       @id @default(autoincrement())   //primary key
  name      String    @unique                         //human key
  problems  Problem[]
}

model ArchivedConversation {
  id          String @id @default(cuid())
  sessionId   String
  userId      String
  data        Json
  archivedAt  DateTime @default(now())
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}